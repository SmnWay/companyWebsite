var projectData = {
  "daisy-tracker": {
    title: "Daisy Tracker",
    category: "App Development",
    description:
      "Daisy Tracker is an innovative mobile application designed to help users monitor and manage their menstrual health. The app offers personalized insights, reminders, and health tracking features to empower users in understanding their bodies better.",
    technologies: [
      "React Native (Expo)",
      "JavaScript",
      "Java/Kotlin",
      "Firebase",
      "RESTful APIs",
    ],
    duration: "3 months",
    team: "3 developers",
    features: [
      "Menstrual cycle tracking with predictions",
      "Symptom and mood logging",
      "Personalized health insights",
      "Reminders for medication and appointments",
    ],
    challenges:
      "Ensuring accurate cycle predictions while accommodating diverse user health profiles. Implementing a user-friendly interface that encourages regular engagement without overwhelming users with notifications.",
    results:
      "500,000+ downloads, 4.4-star rating on Google Play Store, and featured in health and wellness blogs. Achieved a 75% user retention rate after 3 months.",
    metrics: {
      downloads: "500,000+",
      rating: "4.4/5",
      retention: "75%",
      countries: "120+",
    },
  },
  "gallery-app": {
    title: "Pro 3D Magic Gallery",
    category: "App Development",
    description:
      "A revolutionary gallery application that transforms how users interact with their photos and videos. Pro 3D Magic Gallery combines advanced security features with an intuitive 3D interface, offering users a unique and secure way to organize, view, and share their precious memories.",
    technologies: [
      "Android SDK",
      "OpenGL ES",
      "SQLite",
      "Camera2 API",
      "Firebase",
      "Kotlin",
    ],
    duration: "8 months",
    team: "2 developers",
    features: [
      "3D photo carousel and navigation",
      "Advanced security with biometric lock",
      "Private folder with encryption",
      "Smart photo organization and tagging",
      "Video thumbnail generation",
      "Photo editing tools",
      "Slideshow",
      "Multiple view modes (grid, list, 3D)",
    ],
    challenges:
      "Creating smooth 3D transitions on various Android devices while maintaining optimal performance and battery life. Implementing military-grade encryption for private folders without compromising user experience.",
    results:
      "5,000,000+ downloads, 4.5-star rating, featured in Google Play Store's 'Top Apps' category. 92% user retention rate after 30 days.",
    metrics: {
      downloads: "5,000,000+",
      rating: "4.5/5",
      retention: "92%",
      countries: "150+",
    },
  },
  "zoom-camera": {
    title: "Super ZOOM HD Camera",
    category: "App Development",
    description:
      "An advanced camera application designed for photography enthusiasts who demand professional-quality results. Super ZOOM HD Camera features cutting-edge zoom technology, HD recording capabilities, and professional photography tools that rival dedicated camera equipment.",
    technologies: [
      "Android Camera2 API",
      "OpenCV",
      "FFmpeg",
      "Image Processing",
      "HDR Technology",
      "Java/Kotlin",
    ],
    duration: "10 months",
    team: "2 developers",
    features: [
      "4K video recording with stabilization",
      "HDR photo capture",
      "Night mode photography",
      "Manual camera controls (ISO, shutter speed)",
      "Real-time filters and effects",
      "Time-lapse and slow-motion video",
      "Professional editing suite",
      "RAW photo support",
      "Burst mode photography",
      "Panorama and wide-angle shots",
    ],
    challenges:
      "Developing advanced zoom algorithms that maintain image quality while processing high-resolution images in real-time. Optimizing camera performance across different Android devices with varying hardware capabilities.",
    results:
      "1,000,000+ downloads, 4.6-star rating, recognized as 'Editor's Choice' on Google Play. Featured in photography magazines and tech blogs worldwide.",
    metrics: {
      downloads: "1,000,000+",
      rating: "4.6/5",
      retention: "89%",
      awards: "Editor's Choice",
    },
  },
  "music-player": {
    title: "Magic Music Player - SMN",
    category: "App Development",
    description:
      "A sophisticated music player that redefines the audio experience on mobile devices. Magic Music Player combines beautiful design with powerful audio processing, offering users an immersive way to enjoy their music collection with advanced features and customization options.",
    technologies: [
      "Android MediaPlayer",
      "AudioEffect API",
      "SQLite Database",
      "FFT Analysis",
      "Audio Visualization",
      "Kotlin",
    ],
    duration: "6 months",
    team: "1 developer",
    features: [
      "High-quality audio playback (up to 32-bit/384kHz)",
      "10-band equalizer with presets",
      "3D audio effects and surround sound",
      "Real-time audio visualization",
      "Smart playlist generation",
      "GapLess playback",
      "Sleep timer integration",
      "Lyrics display with sync",
      "Custom themes and skins",
      "Gesture controls",
      "CrossFade between songs",
    ],
    challenges:
      "Implementing high-fidelity audio processing while maintaining low battery consumption. Creating smooth visualizations that respond accurately to different music genres and audio frequencies.",
    results:
      "10,000+ downloads in the first month, 4.7-star rating. Featured in music technology blogs and recommended by audio enthusiasts worldwide.",
    metrics: {
      downloads: "10,000+",
      rating: "4.7/5",
      retention: "94%",
      engagement: "45 min/day average",
    },
  },
  bestaucargo: {
    title: "Bestcaucargo",
    category: "Web Development",
    description:
      "A comprehensive logistics and cargo management platform for Bestcaucargo, one of Turkey's leading transportation companies. The platform streamlines cargo operations, tracking, and customer service while providing real-time visibility into shipment status across Turkey and international routes.",
    technologies: ["PHP", "MySQL", "jQuery", "JavaScript", "Google Maps"],
    duration: "4 months",
    team: "1 developers",
    features: [
      "Real-time cargo tracking system",
      "Route optimization and planning",
      "Multi-language support (Turkish/English)",
      "Mobile-responsive design",
    ],
    challenges:
      "Integrating with existing legacy systems while ensuring data accuracy across multiple Turkish cities and international destinations. Implementing real-time tracking that works reliably across Turkey's diverse geographic regions.",
    results:
      "40% reduction in customer service calls, 95% on-time delivery tracking accuracy, 60% increase in online booking volume.",
    metrics: {
      efficiency: "40% fewer service calls",
      accuracy: "95% tracking precision",
      growth: "60% booking increase",
      coverage: "All Turkey + International",
    },
  },
  es21cargo: {
    title: "Es21Cargo",
    category: "Web Development",
    description:
      "A modern cargo and logistics web platform built for Es21Cargo, providing comprehensive shipping solutions across Turkey. The platform offers advanced tracking capabilities, automated pricing, and seamless integration with Turkish logistics infrastructure.",
    technologies: ["PHP", "MySQL", "jQuery", "CSS3/HTML5", "Google Maps"],
    duration: "5 months",
    team: "4 developers",
    features: [
      "Advanced shipment tracking with GPS",
      "Automated pricing calculator",
      "Customer registration and management",
      "Digital waybill generation",
      "Turkish banking integration for payments",
      "Branch locator with maps",
      "Delivery scheduling system",
      "Package insurance options",
      "Multi-branch inventory management",
      "Reporting and analytics dashboard",
      "Customer loyalty program",
      "Integration with Turkish cargo regulations",
    ],
    challenges:
      "Complying with Turkish cargo regulations and tax requirements while building a user-friendly platform. Integrating with multiple Turkish banks and ensuring secure payment processing for cargo services.",
    results:
      "65% increase in online orders, 50% reduction in manual paperwork, 99.2% system uptime, expanded to 15 new Turkish cities.",
    metrics: {
      orders: "65% increase",
      efficiency: "50% less paperwork",
      uptime: "99.2%",
      expansion: "15 new cities",
    },
  },
  cleannest: {
    title: "CleanNest Cleaners",
    category: "Web Development",
    description:
      "A professional cleaning services website for CleanNest Cleaners, Toronto's premier residential and commercial cleaning company. The platform enables online booking, service customization, and customer management while showcasing the company's eco-friendly cleaning approach.",
    technologies: ["JavaScript", "CSS3/HTML5"],
    duration: "1 Week",
    team: "2 developers",
    features: [
      "Before/after photo galleries",
      "Eco-friendly service highlights",
      "Team member profiles",
      "Service area mapping (Toronto GTA)",
      "Automated email confirmations",
      "Customer dashboard and history",
      "Mobile-optimized booking flow",
      "SEO optimization for local search",
      "Integration with Google My Business",
    ],
    challenges:
      "Creating an intuitive booking system that handles complex scheduling requirements for different cleaning services while ensuring mobile accessibility for busy Toronto customers.",
    results:
      "85% increase in online bookings, 300% improvement in local search rankings, 45% reduction in phone inquiries, expanded client base by 120%.",
    metrics: {
      bookings: "85% increase",
      seo: "300% better rankings",
      efficiency: "45% fewer calls",
      growth: "120% client increase",
    },
  },
  nailfinity: {
    title: "Nailfinity",
    category: "Web Development",
    description:
      "Nailfinity is a nail salon for beauty enthusiasts. The website offers online appointment booking, a detailed service menu, and a gallery showcasing the salon's nail designs. It also includes integration with social media platforms to engage with clients.",
    technologies: ["JavaScript", "CSS3/HTML5"],
    duration: "1 Week",
    team: "2 developers",
    features: [
      "Online appointment booking",
      "Service menu with pricing",
      "Photo gallery of nail designs",
      "Contact form and location map",
      "Mobile-responsive design",
      "Social media integration",
      "Special offers and promotions section",
    ],
    challenges:
      "Designing a visually appealing and user-friendly website that effectively showcases the salon's services and nail art portfolio while ensuring seamless mobile accessibility.",
    results:
      "20% increase in appointment bookings, 50% boost in online inquiries, enhanced social media engagement leading to a 30% growth in followers.",
    metrics: {
      sales: "20% increase",
      "order value": "15% increase",
      "returning customers": "25% increase",
    },
  },
};
var projectIds = Object.keys(projectData);
let currentProjectIndex = 0;

document.addEventListener("DOMContentLoaded", function () {
  const navbar = document.getElementById("navbar");
  const navLinks = document.querySelectorAll(".nav-link");

  initializePageLoader();
  initializeAnimations();
  initializeTextAnimations();
  initializeProgressiveReveal();

  const hamburger = document.querySelector(".hamburger");
  const mobileMenu = document.querySelector(".mobile-menu");
  const menuOverlay = document.querySelector(".menu-overlay");
  const mobileMenuClose = document.querySelector(".mobile-menu-close");

  if (hamburger && mobileMenu) {
    hamburger.addEventListener("click", () => {
      mobileMenu.classList.toggle("open");
      hamburger.classList.toggle("open");
    });

    if (mobileMenuClose) {
      mobileMenuClose.addEventListener("click", () => {
        mobileMenu.classList.remove("open");
        hamburger.classList.remove("open");
      });
    }

    if (menuOverlay) {
      menuOverlay.addEventListener("click", () => {
        mobileMenu.classList.remove("open");
        hamburger.classList.remove("open");
      });
    }

    const mobileNavLinks = mobileMenu.querySelectorAll("a");
    mobileNavLinks.forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.remove("open");
        hamburger.classList.remove("open");
      });
    });
  }

  navLinks.forEach((link) => {
    link.addEventListener("click", function () {
      console.log("Nav link clicked, closing menu");
      navMenu.classList.remove("active");
      hamburger.classList.remove("active");
    });
  });

  setTimeout(function () {
    if (navMenu) {
      navMenu.classList.add("active");
      setTimeout(function () {
        navMenu.classList.remove("active");
      }, 2000);
    }
  }, 3000);

  window.addEventListener("scroll", function () {
    if (window.scrollY > 50) {
      navbar.classList.add("scrolled");
    } else {
      navbar.classList.remove("scrolled");
    }
  });

  const backToTopBtn = document.querySelector(".back-to-top");

  if (backToTopBtn) {
    window.addEventListener("scroll", function () {
      if (window.scrollY > 300) {
        backToTopBtn.classList.add("visible");
      } else {
        backToTopBtn.classList.remove("visible");
      }
    });

    backToTopBtn.addEventListener("click", function (e) {
      e.preventDefault();
      window.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    });
  }

  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute("href"));
      if (target) {
        const offsetTop = target.offsetTop - 70;
        window.scrollTo({
          top: offsetTop,
          behavior: "smooth",
        });
      }
    });
  });

  const filterButtons = document.querySelectorAll(".filter-btn");
  const portfolioSections = document.querySelectorAll(".portfolio-section");

  filterButtons.forEach((button) => {
    button.addEventListener("click", function () {
      const filter = this.getAttribute("data-filter");

      filterButtons.forEach((btn) => btn.classList.remove("active"));
      this.classList.add("active");

      portfolioSections.forEach((section) => {
        const category = section.getAttribute("data-category");

        if (filter === "all") {
          section.style.display = "block";
          section.style.opacity = "1";
        } else if (category === filter) {
          section.style.display = "block";
          section.style.opacity = "1";
        } else {
          section.style.display = "none";
          section.style.opacity = "0";
        }
      });

      setTimeout(() => {
        portfolioSections.forEach((section) => {
          if (section.style.display !== "none") {
            section.classList.add("fade-in");
            setTimeout(() => {
              section.classList.remove("fade-in");
            }, 600);
          }
        });
      }, 100);
    });
  });

  window.addEventListener("load", animateOnScroll);
  window.addEventListener("scroll", animateOnScroll);

  const projectModal = document.getElementById("projectModal");
  const modalCloseButtons = document.querySelectorAll(".modal-close");
  const viewProjectButtons = document.querySelectorAll(".view-project-btn");

  document.addEventListener("click", async function (e) {
    if (e.target && e.target.classList.contains("view-project-btn")) {
      const projectId = e.target.getAttribute("data-project");
      if (projectId) {
        currentProjectIndex = projectIds.indexOf(projectId);
        openProjectModal(projectId);
      }
    }
  });

  viewProjectButtons.forEach((button) => {
    button.addEventListener("click", async function () {
      const projectId = this.getAttribute("data-project");
      currentProjectIndex = projectIds.indexOf(projectId);
      openProjectModal(projectId);
    });
  });

  document
    .querySelector(".prev-project")
    .addEventListener("click", async function () {
      if (currentProjectIndex > 0) {
        currentProjectIndex--;
        openProjectModal(projectIds[currentProjectIndex]);
      }
    });

  document
    .querySelector(".next-project")
    .addEventListener("click", async function () {
      if (currentProjectIndex < projectIds.length - 1) {
        currentProjectIndex++;
        openProjectModal(projectIds[currentProjectIndex]);
      }
    });

  document
    .querySelector(".modal-contact-btn")
    .addEventListener("click", function () {
      closeModal(projectModal);

      const contactSection = document.getElementById("contact");
      if (contactSection) {
        contactSection.scrollIntoView({ behavior: "smooth" });
      }
    });

  modalCloseButtons.forEach((button) => {
    button.addEventListener("click", function () {
      if (button.closest("#projectModal")) {
        closeModal(projectModal);
      }
    });
  });

  window.addEventListener("click", function (event) {
    if (event.target === projectModal) {
      closeModal(projectModal);
    }
  });

  document.addEventListener("keydown", function (event) {
    if (event.key === "Escape") {
      if (projectModal && projectModal.style.display === "block") {
        closeModal(projectModal);
      }
    }
  });

  const observerOptions = {
    threshold: 0.1,
    rootMargin: "0px 0px -50px 0px",
  };

  const observer = new IntersectionObserver(function (entries) {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.style.animationDelay = "0.1s";
        entry.target.style.animationFillMode = "both";
        entry.target.style.animation = "fadeInUp 0.8s ease";
      }
    });
  }, observerOptions);

  const animatedElements = document.querySelectorAll(
    ".feature-item, .service-card, .portfolio-item, .testimonial-item, .solution-item"
  );
  animatedElements.forEach((el) => {
    observer.observe(el);
  });

  const statsObserver = new IntersectionObserver(
    function (entries) {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const statNumbers = entry.target.querySelectorAll(".stat-number");
          statNumbers.forEach((statNumber) => {
            animateCounter(statNumber);
          });
          statsObserver.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.5 }
  );

  const statsSection = document.querySelector(".stats");
  if (statsSection) {
    statsObserver.observe(statsSection);
  }

  window.addEventListener("scroll", function () {
    const scrolled = window.pageYOffset;
    const parallaxElements = document.querySelectorAll(".hero-graphic");

    parallaxElements.forEach((element) => {
      const speed = 0.5;
      element.style.transform = `translateY(${scrolled * speed}px)`;
    });
  });

  const serviceCards = document.querySelectorAll(".service-card");
  serviceCards.forEach((card) => {
    card.addEventListener("mouseenter", function () {
      this.style.transform = "translateY(-10px) scale(1.02)";
    });

    card.addEventListener("mouseleave", function () {
      this.style.transform = "translateY(0) scale(1)";
    });
  });

  const allPortfolioItems = document.querySelectorAll(".portfolio-item");

  allPortfolioItems.forEach((item, index) => {
    item.style.animationDelay = `${index * 0.1}s`;
  });

  let currentTestimonial = 0;
  const testimonials = document.querySelectorAll(".testimonial-item");

  if (testimonials.length > 0) {
    setInterval(() => {
      testimonials[currentTestimonial].style.opacity = "0.7";
      currentTestimonial = (currentTestimonial + 1) % testimonials.length;
      testimonials[currentTestimonial].style.opacity = "1";
    }, 5000);
  }

  document.body.classList.add("loaded");
  addInteractiveEffects();
});

function getProjectImage(projectId) {
  const imageMap = {
    "gallery-app": "assets/images/portfolio/3d_icon.png",
    "zoom-camera": "assets/images/portfolio/md_cam.png",
    "music-player": "assets/images/portfolio/m_player.png",
    bestaucargo: "assets/images/portfolio/bestaucargo.png",
    es21cargo: "assets/images/portfolio/es21cargo.png",
    cleannest: "assets/images/portfolio/cleannest.png",
    "daisy-tracker": "assets/images/portfolio/daisy.png",
    nailfinity: "assets/images/portfolio/nailfinity.png",
  };
  return imageMap[projectId];
}

function animateOnScroll() {
  const animatedElements = document.querySelectorAll(
    ".section-header, .service-card, .feature-item, .portfolio-item, .stat-item, " +
      ".reveal, .about-text, .about-visual, .section-badge, .about-highlight, " +
      ".about-shape, .modern-card, .blob, .dot-pattern, .stats-decoration, .stat-icon"
  );

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        }
      });
    },
    {
      threshold: 0.1,
      rootMargin: "0px 0px -100px 0px",
    }
  );

  animatedElements.forEach((el) => {
    observer.observe(el);
  });

  document.addEventListener("mousemove", (e) => {
    const parallaxElements = document.querySelectorAll(
      ".about-shape, .blob, .hero-decoration"
    );
    const mouseX = e.clientX / window.innerWidth;
    const mouseY = e.clientY / window.innerHeight;

    parallaxElements.forEach((el) => {
      const strength = 20;
      const offsetX = (mouseX - 0.5) * strength;
      const offsetY = (mouseY - 0.5) * strength;

      el.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
    });
  });
}

function openProjectModal(projectId) {
  const project = projectData[projectId];

  if (project && Object.keys(projectData).length > 0) {
    const modalBody = document.getElementById("modalBody");

    modalBody.innerHTML = `
                <div class="project-detail">
                    <div class="project-header">
                        <h2>${project.title}</h2>
                        <div class="project-badge">${project.category}</div>
                    </div>
                    
                    <div class="project-showcase">
                        <div class="project-image">
                            <img src="${getProjectImage(projectId)}" alt="${
      project.title
    }" class="modal-project-image" />
                        </div>
                    </div>
                    
                    <div class="project-meta">
                        <div class="meta-item">
                            <div class="meta-icon"><i class="fas fa-calendar-alt"></i></div>
                            <div class="meta-content">
                                <h4>Duration</h4>
                                <p>${project.duration}</p>
                            </div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-icon"><i class="fas fa-users"></i></div>
                            <div class="meta-content">
                                <h4>Team Size</h4>
                                <p>${project.team}</p>
                            </div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-icon"><i class="fas fa-check-circle"></i></div>
                            <div class="meta-content">
                                <h4>Status</h4>
                                <p>Completed</p>
                            </div>
                        </div>
                    </div>
                    
                    ${
                      project.metrics
                        ? `
                    <div class="project-metrics">
                        <h3><i class="fas fa-chart-bar"></i> Key Metrics</h3>
                        <div class="metrics-grid">
                            ${Object.entries(project.metrics)
                              .map(
                                ([key, value]) => `
                                <div class="metric-item">
                                    <div class="metric-value">${value}</div>
                                    <div class="metric-label">${
                                      key.charAt(0).toUpperCase() + key.slice(1)
                                    }</div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                    </div>
                    `
                        : ""
                    }
                    
                    <div class="project-section">
                        <h3><i class="fas fa-info-circle"></i> Project Overview</h3>
                        <p>${project.description}</p>
                    </div>
                    
                    <div class="project-section">
                        <h3><i class="fas fa-code"></i> Technologies Used</h3>
                        <div class="tech-tags">
                            ${project.technologies
                              .map(
                                (tech) =>
                                  `<span class="tech-tag">${tech}</span>`
                              )
                              .join("")}
                        </div>
                    </div>
                    
                    <div class="project-columns">
                        <div class="project-column">
                            <div class="project-section">
                                <h3><i class="fas fa-list-ul"></i> Key Features</h3>
                                <ul class="feature-list">
                                    ${project.features
                                      .map((feature) => `<li>${feature}</li>`)
                                      .join("")}
                                </ul>
                            </div>
                        </div>
                        
                        <div class="project-column">
                            <div class="project-section">
                                <h3><i class="fas fa-exclamation-triangle"></i> Challenges & Solutions</h3>
                                <p>${project.challenges}</p>
                            </div>
                            
                            <div class="project-section">
                                <h3><i class="fas fa-trophy"></i> Results & Impact</h3>
                                <p>${project.results}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

    const prevBtn = document.querySelector(".prev-project");
    const nextBtn = document.querySelector(".next-project");

    prevBtn.disabled = currentProjectIndex === 0;
    nextBtn.disabled = currentProjectIndex === projectIds.length - 1;

    projectModal.style.display = "block";
    document.body.style.overflow = "hidden";
  }
}

function closeModal(modal) {
  if (modal) {
    modal.style.display = "none";
  }
  document.body.style.overflow = "";
  document.body.style.overflowY = "";
}

function isValidEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

function animateCounter(element) {
  const target = parseInt(element.textContent.replace(/\D/g, ""));
  const increment = target / 100;
  let current = 0;

  const timer = setInterval(() => {
    current += increment;
    if (current >= target) {
      element.textContent = element.textContent.replace(/\d+/, target);
      clearInterval(timer);
    } else {
      element.textContent = element.textContent.replace(
        /\d+/,
        Math.ceil(current)
      );
    }
  }, 20);
}

function initializePageLoader() {
  const preloader = document.getElementById("preloader");

  if (preloader) {
    window.addEventListener("load", () => {
      setTimeout(() => {
        preloader.classList.add("fade-out");
        document.body.classList.add("loaded");

        setTimeout(() => {
          preloader.style.display = "none";
        }, 500);
      }, 800); 
    });

    setTimeout(() => {
      if (!document.body.classList.contains("loaded")) {
        preloader.classList.add("fade-out");
        document.body.classList.add("loaded");
        setTimeout(() => {
          preloader.style.display = "none";
        }, 500);
      }
    }, 5000); 
  }
}

function initializeAnimations() {
  const animatedElements = document.querySelectorAll(
    ".reveal, .reveal-up, .reveal-down, .reveal-left, .reveal-right, .reveal-scale, .reveal-rotate"
  );

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("active");
        }
      });
    },
    {
      threshold: 0.1,
      rootMargin: "0px 0px -100px 0px",
    }
  );

  animatedElements.forEach((el) => observer.observe(el));
}

function initializeTextAnimations() {
  const headings = document.querySelectorAll("h1, h2, h3.animate-heading");

  headings.forEach((heading) => {
    const text = heading.textContent;
    const words = text.split(" ");

    heading.innerHTML = words
      .map(
        (word, index) =>
          `<span class="word-animation" style="animation-delay: ${
            index * 0.1
          }s">${word}</span>`
      )
      .join(" ");
  });

  const headingObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const words = entry.target.querySelectorAll(".word-animation");
          words.forEach((word, index) => {
            setTimeout(() => {
              word.classList.add("animate");
            }, index * 100);
          });
          headingObserver.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.5 }
  );

  headings.forEach((heading) => headingObserver.observe(heading));
}

function initializeProgressiveReveal() {
  const gridContainers = document.querySelectorAll(
    ".services-grid, .features-grid, .portfolio-grid, .stats-grid"
  );

  gridContainers.forEach((container) => {
    const items = container.children;

    const gridObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            [...items].forEach((item, index) => {
              setTimeout(() => {
                item.classList.add("reveal", "active");
                item.style.animationDelay = `${index * 0.1}s`;
              }, index * 100);
            });
            gridObserver.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.2 }
    );

    gridObserver.observe(container);
  });
}

function addInteractiveEffects() {
  const hero = document.querySelector(".hero");
  if (hero) {
    createEnhancedParticles(hero);
  }

  const heroTitle = document.querySelector(".hero-title");
  if (heroTitle) {
    createTypingEffect(heroTitle);
  }

  const heroSubtitle = document.querySelector(".hero-subtitle");
  if (heroSubtitle) {
    setTimeout(() => {
      heroSubtitle.classList.add("reveal", "active");
    }, 2000);
  }

  const heroDescription = document.querySelector(".hero-description");
  if (heroDescription) {
    setTimeout(() => {
      heroDescription.classList.add("reveal", "active");
    }, 2500);
  }

  const heroButtons = document.querySelector(".hero-buttons");
  if (heroButtons) {
    setTimeout(() => {
      heroButtons.classList.add("reveal", "active");
    }, 3000);
  }
}

function createTypingEffect(element) {
  const originalText = element.textContent;
  element.textContent = "";
  element.style.borderRight = "3px solid #3b82f6";
  element.style.whiteSpace = "nowrap";
  element.style.overflow = "hidden";

  let i = 0;
  const typeEffect = setInterval(() => {
    element.textContent += originalText.charAt(i);
    i++;
    if (i >= originalText.length) {
      clearInterval(typeEffect);
      setTimeout(() => {
        element.style.borderRight = "none";
        element.style.whiteSpace = "normal";
        element.style.overflow = "visible";
      }, 1000);
    }
  }, 80);
}

function createEnhancedParticles(container) {
  const particleTypes = [
    { size: "3px", color: "rgba(59, 130, 246, 0.4)" },
    { size: "5px", color: "rgba(147, 197, 253, 0.3)" },
    { size: "2px", color: "rgba(30, 58, 138, 0.5)" },
  ];

  for (let i = 0; i < 30; i++) {
    const particle = document.createElement("div");
    const type =
      particleTypes[Math.floor(Math.random() * particleTypes.length)];

    particle.style.cssText = `
      position: absolute;
      width: ${type.size};
      height: ${type.size};
      background: ${type.color};
      border-radius: 50%;
      pointer-events: none;
      animation: float ${4 + Math.random() * 4}s infinite ease-in-out;
      animation-delay: ${Math.random() * 6}s;
      z-index: 1;
    `;

    particle.style.left = Math.random() * 100 + "%";
    particle.style.top = Math.random() * 100 + "%";

    container.appendChild(particle);
  }
}

function createParticles(container) {
  for (let i = 0; i < 20; i++) {
    const particle = document.createElement("div");
    particle.style.cssText = `
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(30, 58, 138, 0.3);
            border-radius: 50%;
            pointer-events: none;
            animation: float 6s infinite ease-in-out;
            animation-delay: ${Math.random() * 6}s;
        `;

    particle.style.left = Math.random() * 100 + "%";
    particle.style.top = Math.random() * 100 + "%";

    container.appendChild(particle);
  }
}

const style = document.createElement("style");
style.textContent = `
    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .hamburger.active .bar:nth-child(2) {
        opacity: 0;
    }
    
    .hamburger.active .bar:nth-child(1) {
        transform: translateY(8px) rotate(45deg);
    }
    
    .hamburger.active .bar:nth-child(3) {
        transform: translateY(-8px) rotate(-45deg);
    }
    
    .loaded {
        opacity: 1;
    }
    
    body {
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .modal-project-image {
        width: 100%;
        max-width: 300px;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        object-fit: cover;
        display: block;
        margin: 0 auto;
    }
    
    .project-image {
        text-align: center;
        padding: 1rem;
    }
`;

document.head.appendChild(style);

window.addEventListener("load", function () {
  document.body.style.opacity = "1";
});

window.addEventListener("resize", function () {
  const navMenu = document.getElementById("nav-menu");
  const hamburger = document.getElementById("hamburger");

  if (window.innerWidth > 768) {
    navMenu.classList.remove("active");
    hamburger.classList.remove("active");
  }
});

function throttle(func, limit) {
  let inThrottle;
  return function () {
    const args = arguments;
    const context = this;
    if (!inThrottle) {
      func.apply(context, args);
      inThrottle = true;
      setTimeout(() => (inThrottle = false), limit);
    }
  };
}

function checkVisibility() {
  const sections = document.querySelectorAll(
    ".section-header, .service-card, .feature-item, .portfolio-item, .stat-item"
  );

  sections.forEach((section) => {
    const sectionTop = section.getBoundingClientRect().top;
    const windowHeight = window.innerHeight;

    if (sectionTop < windowHeight * 0.85) {
      section.classList.add("visible");
    }
  });
}

window.addEventListener("DOMContentLoaded", checkVisibility);

window.addEventListener("scroll", checkVisibility);

// counter
const twoWeekInMs = 14 * 24 * 60 * 60 * 1000; // every 2 week

/**
 * 2% counter increase
 */
function numberFormats(num, digits = 0) {
  const lookup = [
    { value: 1, symbol: "" },
    { value: 1e3, symbol: "k" },
    { value: 1e6, symbol: "M" },
    { value: 1e9, symbol: "G" },
    { value: 1e12, symbol: "T" },
    { value: 1e15, symbol: "P" },
    { value: 1e18, symbol: "E" },
  ];
  const regexp = /\.0+$|(?<=\.[0-9]*[1-9])0+$/;
  const item = lookup.findLast((item) => num >= item.value);
  return item
    ? (num / item.value).toFixed(digits).replace(regexp, "").concat(item.symbol)
    : "0";
}

function increaseCounters(text, defaultValue, allowIncrement = true) {
  const textElement = document.getElementById(text);
  let currentValue =
    textElement.innerHTML.length === 0 ? defaultValue : textElement.innerText;
  if (allowIncrement) {
    const newValue = Math.round(currentValue * 0.02);
    textElement.innerHTML = `<span class="counter">${numberFormats(
      Number(currentValue) + Number(newValue.toFixed(0))
    )}</span>`;
  } else {
    textElement.innerHTML = `<span class="counter">${numberFormats(
      Number(currentValue)
    )}</span>`;
  }
}

// default value set
increaseCounters("userCounter", "263821", false);
increaseCounters("reviewCounter", "23018", false);
increaseCounters("downloadCounter", "12541604", false);
increaseCounters("followerCounter", "335230", false);

setInterval(() => {
  increaseCounters("userCounter", "263821");
  increaseCounters("reviewCounter", "23018");
  increaseCounters("downloadCounter", "12541604");
  increaseCounters("followerCounter", "335230");
}, twoWeekInMs);

// Contact form submission
$(document).ready(function () {
  $("#contactForm").submit(function (e) {
    e.preventDefault();
    submitForm();
  });

  function submitForm() {
    // Initiate Variables With Form Content
    var name = $("#name").val();
    var email = $("#psta_adrss").val(); // Use psta_adrss for email field
    var msg_subject = $("#msg_subject").val();
    var message = $("#message").val();

    const formData = new FormData();
    formData.append("name", name);
    formData.append("psta_adrss", email);
    formData.append("msg_subject", msg_subject);
    formData.append("message", message);

    fetch("send-email.php", {
      method: "POST",
      body: formData,
    })
      .then((response) => response.text())
      .then((data) => {
        if (data.includes("success") || data.includes("sent")) {
          formSuccess();
        } else {
          formError();
          submitMSG(false, "Error sending message. Please try again.");
        }
      })
      .catch((err) => {
        formError();
        submitMSG(false, "Error sending message. Please try again.");
      });
  }

  function formSuccess() {
    $("#contactForm")[0].reset();
    submitMSG(true, "Message Sent Successfully!");
  }

  function formError() {
    $("#contactForm")
      .removeClass()
      .addClass("shake animated")
      .one(
        "webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",
        function () {
          $(this).removeClass();
        }
      );
  }

  function submitMSG(valid, msg) {
    if (valid) {
      var msgClasses = "h3 text-center text-success";
    } else {
      var msgClasses = "h3 text-center text-danger";
    }
    $("#msgSubmit").removeClass().addClass(msgClasses).text(msg).show();

    // Hide message after 5 seconds
    setTimeout(function () {
      $("#msgSubmit").fadeOut();
    }, 5000);
  }
});

function openApplicationModal(position) {
  const modal = document.getElementById("applicationModal");
  const positionInput = document.getElementById("position");

  if (position === "intern") {
    positionInput.value = "Software Development Intern";
  }

  modal.style.display = "block";
  document.body.style.overflow = "hidden";
}

document.addEventListener("DOMContentLoaded", function () {
  const modal = document.getElementById("applicationModal");
  const closeBtn = document.querySelector("#applicationModal .modal-close");
  const applicationForm = document.getElementById("applicationForm");

  // Close modal when close button is clicked
  if (closeBtn) {
    closeBtn.onclick = function () {
      modal.style.display = "none";
      document.body.style.overflow = "auto";
    };
  }

  // Close modal when clicking outside the modal content
  window.onclick = function (event) {
    if (event.target === modal) {
      modal.style.display = "none";
      document.body.style.overflow = "auto";
    }
  };

  // Close modal with Escape key
  document.addEventListener("keydown", function (event) {
    if (event.key === "Escape" && modal && modal.style.display === "block") {
      modal.style.display = "none";
      document.body.style.overflow = "auto";
    }
  });

  // Handle form submission
  if (applicationForm) {
    applicationForm.addEventListener("submit", function (e) {
      e.preventDefault();

      const submitBtn = this.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;

      // Show loading state
      submitBtn.innerHTML =
        '<i class="fas fa-spinner fa-spin"></i> Submitting...';
      submitBtn.disabled = true;

      // Create FormData object
      const formData = new FormData(this);

      // Submit form via AJAX
      fetch("form-process.php", {
        method: "POST",
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            // Show success message
            alert(
              "Application submitted successfully! We will review it and get back to you soon."
            );
            this.reset();
            modal.style.display = "none";
            document.body.style.overflow = "auto";
          } else {
            // Show error message
            alert("Error: " + data.message);
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert(
            "An error occurred while submitting your application. Please try again."
          );
        })
        .finally(() => {
          // Reset button state
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        });
    });
  }
});
